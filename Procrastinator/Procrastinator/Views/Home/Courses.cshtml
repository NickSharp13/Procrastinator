@model Procrastinator.Models.CourseSelectionViewModel
@{
    ViewBag.Title = "Courses";
}
<head>
    <link href="@Url.Content("~/Content/Site.css")" rel="stylesheet" type="text/css" />
</head>

<body>
    <h2>Courses</h2>

    <h4>Add courses to your schedule:</h4>

    <div id="container">
        <form class="form-inline" action="~/Home/Events" method="post">
            <div id="home" class="tab-pane fade in active">
                <div id="courseContainer">
                    <div class="form-group">
                        @Html.DropDownListFor(m => m.SelectedSubjectType, new SelectList(Model.SubjectTypes, "SubjectTypeId", "Subject"), "Select a Subject", new { @id = "subject", @class = "form-control" })
                        @Html.DropDownListFor(m => m.Courses, new SelectList(Model.Courses, "Id", "Description"), "Select a Course", new { @id = "course", @class = "form-control" })
                        <span class="glyphicon glyphicon-trash form-group" style="font-size:20px"></span>
                    </div>
                </div>
                <div class="form-group">
                    <input type="hidden" id="end">
                    <button type="button" id="addCourse" class="btn btn-primary">Add Course</button>
                    <button type="submit" class="btn btn-primary">Next</button>
                </div>
            </div>
        </form>
    </div>
</body>

<!-- Course script -->
<script>
    $(function () {
        $("[name='SelectedSubjectType']").on("change", function () {
            debugger;
            var index = jQuery(this).attr("id").replace("subject", "");
            var selectedSubject = $(this).find(":selected").val();

            $.ajax({
                type: 'POST',
                url: "/Home/GetCourses",
                dataType: "json",
                data: { subjectTypeId: selectedSubject },
                success: function (data) {
                    var $dropdown = $("#course" + index);
                    $dropdown.empty();
                    $("#course" + index).append($("<option />").val('').text('Select a Course'));
                    $.each(data, function () {
                        $dropdown.append($("<option />").val(this.Id).text(this.Description));
                    });
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    alert("some error");
                }
            });
        });
    });

    var index = 2;
    $("#addCourse").click(function () {
        debugger;
        var newRow = $("#courseContainer").clone(true, true);
        newRow.find('label').hide();
        jQuery('#subject', newRow).prop('id', 'subject' + index);
        jQuery('#course', newRow).attr('id', 'course' + index);
        jQuery('#remove', newRow).attr('id', 'remove' + index);

        jQuery(newRow).insertBefore('#end');
        $('#subject' + index).change();

        index++;
    });

    $('body').on('click', '.glyphicon-trash', function () {
        debugger;
        $(this).parent().parent('div').remove();
    });
</script>

