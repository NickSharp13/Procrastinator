@model Procrastinator.Models.EventSelectionViewModel
@{
    ViewBag.Title = "Events";
}

<head>
    <link href="@Url.Content("~/Content/Site.css")" rel="stylesheet" type="text/css" />
</head>

<body>
    <h2>Events</h2>

    <h4>Add events to your schedule:</h4>

    <div id="container">
        <form class="form-inline" action="~/Home/Events" method="post">
            <div id="home" class="tab-pane fade in active">
                <div id="eventContainer">
                    <div class="form-group">
                        <select id="EventType" name="EventType" class="form-control" style="display: inline-block">
                            <option value=""> Select Event </option>
                        </select>
                        &nbsp Hours: <input type="text" />
                        &nbsp Minutes: <input type="text" />
                        @* @Html.DropDownListFor(m => m.SelectedEventType, new SelectList(Model.EventTypes, "EventTypeId", "Event"), "Select an Event", new { @id = "event", @class = "form-control" }) *@
                    <div class="weekDays-selector" style="display: inline-block">
                        <input type="checkbox" id="weekday-mon" class="weekday" />
                        <label for="weekday-mon">M</label>
                        <input type="checkbox" id="weekday-tue" class="weekday" />
                        <label for="weekday-tue">T</label>
                        <input type="checkbox" id="weekday-wed" class="weekday" />
                        <label for="weekday-wed">W</label>
                        <input type="checkbox" id="weekday-thu" class="weekday" />
                        <label for="weekday-thu">T</label>
                        <input type="checkbox" id="weekday-fri" class="weekday" />
                        <label for="weekday-fri">F</label>
                        <input type="checkbox" id="weekday-sat" class="weekday" />
                        <label for="weekday-sat">S</label>
                        <input type="checkbox" id="weekday-sun" class="weekday" />
                        <label for="weekday-sun">S</label>
                    </div>
                    </div>
                </div>
            </div>
        </form>
        <div class="form-group">
            <input type="hidden" id="end">
            <br />
            <button type="button" id="addEvent" class="btn btn-primary">Add Event</button>
            <button type="submit" class="btn btn-primary">Next</button>
        </div>
    </div>
</body>


<!-- Event script -->
<script>
    $(function () {
        $("[name='SelectedEventType']").on("change", function () {
            debugger;
            var index = jQuery(this).attr("id").replace("event", "");
            var selectedEvent = $(this).find(":selected").val();

            $.ajax({
                type: 'POST',
                url: "/Home/GetEvents",
                dataType: "json",
                data: { EventId: selectedEvent },
                success: function (data) {
                    var $dropdown = $("#event" + index);
                    $dropdown.empty();
                    $("#event" + index).append($("<option />").val('').text('Select an Event'));
                    $.each(data, function () {
                        $dropdown.append($("<option />").val(this.Id).text(this.Description));
                    });
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    alert("Error selecting event");
                }
            });
        });
    });



    var index = 2;
    $("#addEvent").click(function () {
        debugger;
        var newRow = $("#eventContainer").clone(true, true);
        newRow.find('label').hide();
        jQuery('#event', newRow).prop('id', 'event' + index);
        jQuery('#remove', newRow).attr('id', 'remove' + index);

        jQuery(newRow).insertBefore('#end');
        $('#event' + index).change();

        index++;
    });

    $('body').on('click', '.glyphicon-trash', function () {
        debugger;
        $(this).parent().parent('div').remove();
    });
</script>